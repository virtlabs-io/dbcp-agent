scope: {{ .Cluster.Name }}
name: {{ .Node.ETCD.PeerName }}

restapi:
  listen: {{ .Node.Patroni.APIListen }}
  connect_address: {{ .Node.Patroni.APIListen }}

etcd:
  host: {{ .Node.Patroni.EtcdHost }}

bootstrap:
  dcs:
    ttl: {{ .Node.Patroni.DCS.TTL }}
    loop_wait: {{ .Node.Patroni.DCS.LoopWait }}
    retry_timeout: {{ .Node.Patroni.DCS.RetryTimeout }}
    maximum_lag_on_failover: {{ .Node.Patroni.DCS.MaximumLagOnFailover }}
  initdb:
    {{ range .Node.Patroni.InitDB }}
    - {{ . }}
    {{ end }}

postgresql:
  listen: {{ .Node.Host }}:{{ .Node.Patroni.PGPort }}
  connect_address: {{ .Node.Host }}:{{ .Node.Patroni.PGPort }}
  data_dir: {{ .Node.PostgreSQL.DataDir }}
  bin_dir: {{ .Node.PostgreSQL.BinPath }}
  authentication:
    superuser:
      username: {{ .Node.Patroni.Superuser.Username }}
      password: {{ .Node.Patroni.Superuser.Password }}
    replication:
      username: {{ .Node.Patroni.Replication.Username }}
      password: {{ .Node.Patroni.Replication.Password }}
    {{ if .Node.Patroni.AdminUser.Username }}
    users:
      {{ .Node.Patroni.AdminUser.Username }}:
        password: {{ .Node.Patroni.AdminUser.Password }}
        options:{{ range .Node.Patroni.AdminUser.Options }}
          - {{ . }}
        {{ end }}
    {{ end }}
  parameters:
    wal_keep_segments: 8
    hot_standby: "on"
  use_pg_rewind: {{ .Node.Patroni.UsePGRewind }}
  use_slots: {{ .Node.Patroni.UseSlots }}
